function CalcularIdade(n,t){var i=t.getFullYear()-n.getFullYear();return new Date(t.getFullYear(),t.getMonth(),t.getDate())<new Date(t.getFullYear(),n.getMonth(),n.getDate())&&i--,parseInt(i)}function ValidarFormulario(){var n="";return $("span[id*=-error]").each(function(t,i){n+=$(i).text()+"<br>"}),n}function IncluirCelulasTabela(n,t,i,r,u){var f=n.insertCell(t);i!=null&&i!=undefined&&i!=""&&(f.width=i);u!=null&&u!=undefined&&u!=""&&(f.colSpan=u);f.innerHTML=r}function HabilitarBotoesTabela(n,t){$(n).find("tr").each(function(n,i){var r=$(i);$(r).find(".btn").each(function(n,i){$(i).prop("disabled",t)})})}function ExcluirRowObs(n){$.showYesNoAlert("Deseja excluir a Observação?","Excluir Observação",function(){var i=n.parentNode.parentNode.sectionRowIndex,r=document.getElementById("tbObs").getElementsByTagName("tbody")[0],t;r.deleteRow(i);obs.splice(i,1);obs.length==0&&(t=r.insertRow(0),t.className="jtable-data-row",IncluirCelulasTabela(t,0,"100%","Não há observações cadastradas para o Membro",4))})}function AtualizarRowObs(n){var t=n.parentNode.parentNode.sectionRowIndex;indexObs=t;$("#Observacao").val(obs[t].Observacao);$("#DataCadastroObs").val(obs[t].DataCadastroObs);$("#btnAddObs").val("Atualizar");$("#Observacao").focus();HabilitarBotoesTabela($(document.getElementById("tbObs").getElementsByTagName("tbody")),!0)}function CarregarDadosObservacao(n,t,i,r,u){return{Observacao:n,DataCadastroObs:t,ResponsavelObs:i,IdResponsavelObs:r,MostrarBotao:u}}function MontarGridObs(n){var r=document.getElementById("tbObs").getElementsByTagName("tbody")[0],t,i,u;for($(r).empty(),t=0;t<n.length;t++)i=r.insertRow(t),i.className="jtable-data-row"+(t%2==0?" jtable-row-even":""),IncluirCelulasTabela(i,0,null,n[t].Observacao),IncluirCelulasTabela(i,1,null,n[t].DataCadastroObs),IncluirCelulasTabela(i,2,null,n[t].ResponsavelObs),(n[t].MostrarBotao||permiteexcluirobservacaomembro&&!isreadonly)&&(u=' <button type="button" class="btn btn-info btn-sm" onclick="AtualizarRowObs(this);"><span class="glyphicon glyphicon-refresh"><\/span> Atualizar<\/button> <button type="button" class="btn btn-danger btn-sm" onclick="ExcluirRowObs(this);"><span class="glyphicon glyphicon-trash"><\/span> Excluir<\/button>',IncluirCelulasTabela(i,3,null,u))}function MontarGridArquivo(){var t=EncontrarItem(arquivos,function(n){return n.IsCurso==!1&&n.IsDelete==!1}),f=$("#IsReadOnly").val().toLowerCase()=="true",r,n,i,u;if(t==undefined||t.length==0)r=document.getElementById("tbArq").getElementsByTagName("tbody")[0],$(r).empty(),i=r.insertRow(0),i.className="jtable-data-row",IncluirCelulasTabela(i,0,"100%","Não há Documentos cadastrados para o Candidato",4);else for(r=document.getElementById("tbArq").getElementsByTagName("tbody")[0],$(r).empty(),n=0;n<t.length;n++)i=r.insertRow(n),i.className="jtable-data-row"+(n%2==0?" jtable-row-even":""),IncluirCelulasTabela(i,0,null,t[n].DescricaoArquivo),IncluirCelulasTabela(i,1,null,t[n].NomeOriginal),IncluirCelulasTabela(i,2,null,bytesToSize(t[n].Tamanho)),u="",f||(u+=t[n].IsSave?' <button type="button" class="btn btn-danger btn-sm" onclick="ExcluirRowArq(this,{0});"><span class="glyphicon glyphicon-trash"><\/span> Excluir<\/button>'.format(t[n].Id):' <button type="button" class="btn btn-danger btn-sm" onclick="ExcluirRowArq(this,{0});"><span class="glyphicon glyphicon-trash"><\/span> Excluir<\/button>'.format(t[n].Index)),t[n].IsSave&&t[n].NomeOriginal!=null&&t[n].NomeOriginal!=undefined&&t[n].NomeOriginal!=""&&(u+=' <button type="button" class="btn btn-info btn-sm" onclick="DownloadRowArq(this,{0});"><span class="glyphicon glyphicon-download-alt"><\/span> Download<\/button>'.format(t[n].Id)),IncluirCelulasTabela(i,3,null,u)}function HabilitarBotoesTabela(n,t){$(n).find("tr").each(function(n,i){var r=$(i);$(r).find(".btn").each(function(n,i){$(i).prop("disabled",t)})})}function bytesToSize(n){var t;return n==0?"0 Byte":(t=parseInt(Math.floor(Math.log(n)/Math.log(1024))),Math.round(n/Math.pow(1024,t),2)+" "+["Bytes","KB","MB","GB","TB"][t])}function DownloadRowArq(n,t){Download(t)}function ExcluirRowArq(n,t){$.showYesNoAlert("Deseja excluir o Arquivo?","Excluir Arquivo",function(){ExcluirArquivo(t);MontarGridArquivo()})}function CarregarDadosArquivo(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k){return{IsCurso:n,Cadastrado:t,Id:i,MembroId:r,CursoId:u,NomeCurso:f,Local:e,DataInicioCurso:o,DataEncerramentoCurso:s,CargaHoraria:h,Arquivo:c,ArquivoCurso:l,DescricaoArquivo:a,NomeOriginal:v,Tamanho:y,IsDelete:p,IsSave:w,Index:b,IsDone:k}}function gera_id(){for(var t=Math.ceil(Math.random()*Math.pow(10,7)),n=Math.ceil(Math.log(t)),i;n>10;)n=Math.ceil(Math.log(n));return i="{0}{1}".format(t,n),parseInt(i)}function ExcluirArquivo(n){var t=EncontrarIndice(arquivos,function(t){return t.Index==n});t>-1&&(arquivos[t].IsDelete=!0)}function ExistsFileToSave(){for(var n=0;n<arquivos.length;n++)if(arquivos[n].IsDelete&&arquivos[n].IsSave||!arquivos[n].IsDelete&&!arquivos[n].IsSave)return!0;return!1}function AddRowGridModal(n,t){var r=$("#modalSalvar table")[0].getElementsByTagName("tbody")[0],i=r.insertRow(r.rows.length),u,f;i.setAttribute("name","row{0}".format(n));u=i.insertCell(0);f=i.insertCell(1);u.innerHTML='<span id="lbl{0}">{1}<\/span>'.format(n,t);f.innerHTML='<div id="div{0}"><div class="as-reload-img"><div><\/div>'.format(n)}function HabilitarBotaoModal(n){return count=n.reduce(function(n,t){return n+ +t.IsDone},0),n.length==count}function Download(n,t){var i="/Secretaria/Membro/DownloadArquivo?id={0}".format(n);$.downloadArquivo(i,t)}function showImagePreview(n){$(dom.uploads).html("");$(dom.fileDescription).html("");var t=$(new Image).appendTo(dom.uploads),i=new mOxie.Image;i.onload=function(){i.downsize(180,230);t.prop("src",i.getAsDataURL());t.prop("id","imgFoto");t.prop("class","arquivoFoto");t.prop("alt","Foto")};i.load(n.getSource());setTimeout(function(){var n=$(".arquivoFoto").attr("src");if(n==undefined){removerFoto();i.destroy();t.prop("id","imgFoto");t.prop("class","arquivoFoto");t.prop("alt","Foto");t.prop("src","");$.bsMessageWarning("Atenção","Formato de arquivo inválido!");return}},300);$(dom.fileDescription).append('<div id="'+n.id+'">'+n.name+" ("+plupload.formatSize(n.size)+") <b><\/b><\/div>")}function removerBordaFoto(){$("#imgFoto").attr("src")!=undefined&&$("#imgFoto").attr("src")!=""&&($(dom.fotoBorder).css("border","0px"),$(dom.removeFile).css("display","block"))}function removerFoto(){$("#imgFoto").attr("src","");$("#imgFoto").attr("alt","Foto");$(dom.hdnFoto).val("");$(dom.fotoBorder).css("border","1px solid black")}var indexObs=-1,permiteexcluirobservacaomembro=!1,isreadonly=!1,files,arquivos=[],urlFechar="",dom;$(function(){var t=$("#Acao").val(),i,n;permiteexcluirobservacaomembro=$("#PermiteExcluirObservacaoMembro").val().toLowerCase()=="true";isreadonly=$("#Pessoa_somenteleitura").val().toLowerCase()=="true";(obs==null||obs==undefined)&&(obs=[]);(t=="Create"||t=="Read"||t=="Update"||t=="Delete")&&obs&&obs.length>0&&MontarGridObs(obs);$("#lnkBuscarCongregacao").removeAttr("class");i=$("#hdnUsuarioSede").val().toLowerCase()==="true";i===!1?($("#CongregacaoId").attr("readonly","readonly"),$("#lnkBuscarCongregacao").attr("class","disabled")):$("#lnkBuscarCongregacao").popUp("","Congregacao","CongregacaoId");$("#CongregacaoId").blur(function(){var n=$(this).val(),t;n>0&&(t={CongregacaoId:n},$.ajaxPost("/Secretaria/Congregacao/BuscarCongregacao",t,function(n){$("#CongregacaoNome").val("");n.Id==0?($.bsMessageError("Atenção","Código inválido!"),$(this).val("")):n.Id>0&&$("#CongregacaoNome").val(n.Nome)}))});$("#BatismoId").change(function(){var n=$("option:selected",$("#BatismoId")).text(),i=$(document).find("[data-valmsg-for='DataPrevistaBatismo']"),t;return i.html(""),n!=null&&n!=undefined&&n!=""&&(t=new Date,t.setYear(n.split("/")[2]),t.setMonth(n.split("/")[1]-1),t.setDate(n.split("/")[0]),t.getTime()<(new Date).getTime())?(i.html('<span id="DataPrevistaBatismo-error" class="">A Data prevista para o Batismo deve ser maior que a Data Atual<\/span>'),!1):void 0});$("#Pessoa_DataNascimento").change(()=>{if($("#Pessoa_DataNascimento").val()!=null&&$("#Pessoa_DataNascimento").val()!=""){let n=$("#Pessoa_DataNascimento").val().split("/"),r=new Date(n[2],n[1]-1,n[0]),t=$(document).find("[data-valmsg-for='Pessoa.DataNascimento']");if(r>=new Date){$.alertError("Batismo","Data de Nascimento maior que a Data Atual");t.html("Data de Nascimento maior que a Data Atual");return}let i=$("option:selected",$("#BatismoId")).val(),u=$("#DataPrevistaBatismo").val();if(i!=null&&i!=""||u!=null&&u!=""){let n={id:i};$.ajaxPost(urlBuscarBatismo,n,function(n){if(n.batismo){let f=new Date(n.batismo.DataBatismo),i=CalcularIdade(r,f),u=`<h3 style="color:red">A Idade do Candidato (${i} anos) é inferior a idade mínima permitida (${n.batismo.IdadeMinima} anos) para o Batismo.</h3><br />`;t.html("");let e=$("#hdnUsuarioSede").val().toLowerCase()==="true";e===!1&&i<n.batismo.IdadeMinima&&($.alertError("Batismo",u),t.html(u.replace("<h3 style=","").replace('"',"").replace("color:red","").replace('">',"").replace("<\/h3><br />","")))}})}}});$(document).on("click","#lnkExcluir",{},function(n){n.preventDefault();var t={id:$(this).data("membroid")};$.showYesNoAlert('<h3 style="color:red">Você tem certeza que deseja excluir este Candidato ao Batismo?<\/br>Após a confirmação NÃO será mais possível recuperar os dados.<\/h3>',"Membro",function(){$.ajaxPost(urlExcluir,t,function(n){n.status==="OK"?window.location=n.url:$.alertError("Membro",n.mensagem)})})});$(document).on("click","#btnCancObs",{},function(n){n.preventDefault();$("#Observacao").val("");$("#DataCadastroObs").val("");indexObs=-1;$("#btnAddObs").val("Adicionar");HabilitarBotoesTabela($(document.getElementById("tbObs").getElementsByTagName("tbody")),!1)});$(document).on("click","#btnAddObs",{},function(n){var t,f,u,i,r;if(n.preventDefault(),t=CarregarDadosObservacao($("#Observacao").val(),$("#DataCadastroObs").val(),$("#nomeUsuarioObs").val(),$("#idUsuarioObs").val(),!0),f=$(document).find("[data-valmsg-for='Observacao']"),f.html(""),u=$(document).find("[data-valmsg-for='DataCadastroObs']"),u.html(""),i=!1,(t.Observacao==null||t.Observacao==undefined||t.Observacao==0)&&(i=!0,f.html('<span id="Observacao-error" class="">O campo Observação é obrigatório<\/span>')),(t.DataCadastroObs==null||t.DataCadastroObs==undefined||t.DataCadastroObs==0)&&(i=!0,u.html('<span id="DataCadastroObs-error" class="">O campo Data de Cadastro é obrigatório<\/span>')),t.DataCadastroObs!=null&&t.DataCadastroObs!=undefined&&t.DataCadastroObs!=""&&(r=new Date,r.setYear(t.DataCadastroObs.split("/")[2]),r.setMonth(t.DataCadastroObs.split("/")[1]-1),r.setDate(t.DataCadastroObs.split("/")[0]),r.getTime()>(new Date).getTime()&&(u.html('<span id="DataCadastroObs-error" class="">A Data de Cadastro da Observação deve ser menor que a Data Atual<\/span>'),i=!0)),i)return!1;indexObs>-1&&(obs.splice(indexObs,1),indexObs=-1);obs.push(t);obs.sort(function(n,t){var i=n.DataCadastroObs.split("/"),u=new Date(i[2],i[1]-1,i[0]),r;return i=t.DataCadastroObs.split("/"),r=new Date(i[2],i[1]-1,i[0]),u<r?1:u>r?-1:0});MontarGridObs(obs);$("#btnAddObs").val("Adicionar");$("#Observacao").val("");$("#DataCadastroObs").val("");permiteexcluirobservacaomembro&&!isreadonly&&HabilitarBotoesTabela($(document.getElementById("tbObs").getElementsByTagName("tbody")),!1)});if(arquivosMembros&&arquivosMembros.length>0){for(n=0;n<arquivosMembros.length;n++)arquivos.push(CarregarDadosArquivo(arquivosMembros[n].IsCurso,arquivosMembros[n].Cadastrado,arquivosMembros[n].Id,arquivosMembros[n].MembroId,arquivosMembros[n].IsCurso?arquivosMembros[n].CursoId:0,arquivosMembros[n].IsCurso?arquivosMembros[n].NomeCurso:"",arquivosMembros[n].IsCurso?arquivosMembros[n].Local:"",arquivosMembros[n].IsCurso?formatJsonToDate(arquivosMembros[n].DataInicioCurso):"",arquivosMembros[n].IsCurso?formatJsonToDate(arquivosMembros[n].DataEncerramentoCurso):"",arquivosMembros[n].IsCurso?arquivosMembros[n].CargaHoraria:"",null,null,arquivosMembros[n].IsCurso?"":arquivosMembros[n].DescricaoArquivo,arquivosMembros[n].NomeOriginal,arquivosMembros[n].Tamanho,!1,arquivosMembros[n].IsSave,arquivosMembros[n].Index));MontarGridArquivo()}$("#Arquivo").on("change",function(n){var t=this.value.split(".").pop();typeof["pdf"].find(n=>t.toLowerCase()==n)=="undefined"?($.alertError("Upload de Arquivo","Somente arquivos do Tipo PDF são permitidos para Upload."),this.value=""):files=n.target.files});$(document).on("click","#btnAddArq",{},function(){var f=$("#Id").val(),t=$("#DescricaoArquivo").val(),i=!1,r=$(document).find("[data-valmsg-for='Arquivo']"),u=$(document).find("[data-valmsg-for='DescricaoArquivo']"),n;r.html("");u.html("");(t==null||t==""||t==undefined)&&(u.html('<span id="DescricaoArquivo-error" class="">Descrição do Arquivo é obrigatório<\/span>'),i=!0);files==null||files==undefined||files.length==0?(r.html('<span id="Arquivo-error" class="">Você deve selecionar um Arquivo<\/span>'),i=!0):files[0].size>2097152&&(r.html('<span id="Arquivo-error" class="">Arquivo maior que 2 MB. Tamanho do arquivo selecionado: {0}.<\/span>'.format(bytesToSize(files[0].size))),i=!0);i||(n=null,files!=null&&files!=undefined&&files.length>0&&(n=files[0]),arquivos.push(CarregarDadosArquivo(!1,null,0,f,null,null,null,null,null,null,n,null,t,n.name,n.size,!1,!1,gera_id())),MontarGridArquivo(),$("#Arquivo").val(""),$("#DescricaoArquivo").val(""))});$(document).on("click","#btnCancArq",{},function(){$("#Arquivo").val("");$("#DescricaoArquivo").val("")});$("#btnSalvar").click(function(n){var r,u,i,t;if(n.preventDefault,r=$("#frmMembro"),u=r.attr("action"),r.valid()){let n=$("#Pessoa_DataNascimento").val().split("/"),t=new Date(n[2],n[1]-1,n[0]);if(i=$(document).find("[data-valmsg-for='Pessoa.DataNascimento']"),t>=new Date){$.alertError("Batismo","Data de Nascimento maior que a Data Atual");i.html("Data de Nascimento maior que a Data Atual");return}let r={id:$("option:selected",$("#BatismoId")).val()};$.ajaxPost(urlBuscarBatismo,r,function(n){if(n.batismo){let e=new Date(n.batismo.DataBatismo),r=CalcularIdade(t,e);i.html("");let f=`<h3 style="color:red">A Idade do Candidato (${r} anos) é inferior a idade mínima permitida (${n.batismo.IdadeMinima} anos) para o Batismo.</h3><br />`,o=$("#hdnUsuarioSede").val().toLowerCase()==="true";if(o===!1&&r<n.batismo.IdadeMinima)$.alertError("Batismo",f),i.html(f.replace("<h3 style=","").replace('"',"").replace("color:red","").replace('">',"").replace("<\/h3><br />",""));else{let t=r<n.batismo.IdadeMinima?f:"";t+=$("#EnviarBatismo")===!0?"Deseja realmente enviar o Membro para o Batismo?":$("#Acao").val()==="Update"?"Deseja realmente atualizar o Candidato ao Batismo?":"Deseja realmente criar um novo Candidato ao Batismo?";$.showYesNoAlert(t,"Batismo",function(){if($("#Obs").val(JSON.stringify(obs)),ExistsFileToSave()){var n=$("#modalSalvar table")[0].getElementsByTagName("tbody")[0];$(n).empty();$("#modalSalvar").modal({backdrop:"static"});AddRowGridModal(0,"Salvando os dados do Candidato ao Batismo");$.ajaxPostForm(u,$("#frmMembro"),function(n){var t,u,i,f,e,r;if(n.status=="OK"){for(urlFechar=n.url,$('#modalSalvar tbody tr[name="row0"').find('span[id="lbl0"]').html(n.msg),$('#modalSalvar tbody tr[name="row0"').find('div[id="div0"]').html('<span class="label label-success">Finalizado<\/span>'),t=0;t<arquivos.length;t++)arquivos[t].MembroId=n.membroid;for(t=0;t<arquivos.length;t++)u="/Secretaria/Membro/SalvarExcluirArquivos",arquivos[t].IsDelete&&arquivos[t].IsSave||!arquivos[t].IsDelete&&!arquivos[t].IsSave?window.FormData!==undefined&&(i=new FormData,arquivos[t].Arquivo!=null&&arquivos[t].Arquivo!=undefined&&i.append("files",arquivos[t].Arquivo),f=null,e=CarregarDadosArquivo(arquivos[t].IsCurso,f,arquivos[t].Id,arquivos[t].MembroId,arquivos[t].CursoId,arquivos[t].NomeCurso,arquivos[t].Local,arquivos[t].DataInicioCurso,arquivos[t].DataEncerramentoCurso,arquivos[t].CargaHoraria,null,null,arquivos[t].DescricaoArquivo,arquivos[t].NomeOriginal,arquivos[t].Tamanho,arquivos[t].IsDelete,arquivos[t].IsSave,arquivos[t].Index),i.append("model",JSON.stringify(e)),$.ajax({type:"POST",url:u,contentType:!1,processData:!1,data:i,beforeSend:function(){arquivos[t].IsDelete?AddRowGridModal(arquivos[t].Index,'Excluindo o Documento <b>"{0}"<\/b>'.format(arquivos[t].DescricaoArquivo)):AddRowGridModal(arquivos[t].Index,'Salvando o Documento <b>"{0}"<\/b>'.format(arquivos[t].DescricaoArquivo))},success:function(n){var t='#modalSalvar tbody tr[name="row{0}"]'.format(n.index),r='span[id="lbl{0}"]'.format(n.index),u='div[id="div{0}"]'.format(n.index),i;n.status=="OK"?($(t).find(r).html(n.msg),$(t).find(u).html('<span class="label label-success">Finalizado<\/span>')):($(t).find(r).html("<b>{0}<\/b>".format(n.msg)),$(t).find(u).html('<span class="label label-danger">Erro<\/span>'));i=EncontrarIndice(arquivos,function(t){return t.Index==n.index});i>-1&&(arquivos[i].IsSave=!0,arquivos[i].IsDone=!0);HabilitarBotaoModal(arquivos)&&$("#divFooter").css("display","block")}})):arquivos[t].IsDone=!0}else return r=$('#modalSalvar tbody tr[name="row0"'),r.find('span[id="lbl0"]').html(n.msg),r.find('div[id="div0"]').html('<span class="label label-danger">Erro<\/span>'),$("#divFooter").css("display","block"),urlFechar="",!1})}else $.ajaxPostForm(u,$("#frmMembro"),function(n){n.status==="OK"?window.location=n.url:$.alertError("Batismo",n.msg)})})}}else $.alertError("Batismo","Batismo não encontrado!")})}else t=ValidarFormulario(),t!=null&&t!=undefined&&t!=""&&$.alertError("Candidato ao Batismo",t)});$(document).on("click","#btnFecharModal",{},function(n){urlFechar!=""&&urlFechar!=null&&urlFechar!=undefined&&(n.preventDefault,window.location=urlFechar)})});$(function(){"use strict";dom={uploader:$("#uploader"),uploads:$("#divFoto"),fileDescription:$("#arquivoDescricao"),fotoBorder:$("#fotoBorder"),removeFile:$("#removeFile"),hdnFoto:$("#Pessoa_FotoPath")};removerBordaFoto();var n=new plupload.Uploader({runtimes:"html5",url:pathUrl,drop_element:"uploader",browse_button:"selectFiles",container:"uploader",max_file_size:"1024mb",resize:{width:180,height:230,quality:90},filters:[{title:"Arquivo de Imagem",extensions:"jpg,png"}]});n.bind("QueueChanged",function(n){n.files.length>1&&n.files.splice(0,1);for(var t=0;t<n.files.length;t++)showImagePreview(n.files[t]),setTimeout(function(){var n=$(".arquivoFoto").attr("src");n!=undefined&&removerBordaFoto();$(dom.hdnFoto).val(n)},300)});n.init();$(dom.removeFile).on("click",function(){n.files.length>1&&n.files.splice(0,1);removerFoto();$(this).css("display","none")})});