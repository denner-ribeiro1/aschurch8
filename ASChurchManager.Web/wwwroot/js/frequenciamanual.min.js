function ExibirDatasFinalizadas(n){let t=$("#PresencaId").val(),i=$(n).prop("checked"),r={idPresenca:t,somenteFinalizados:i,incluirAndamento:!0};$.ajaxPost(urlBuscarDatas,r,function(n){if(n.status=="OK"){let r=n.data;$("#DataId").empty();let u=$("<option><\/option>").appendTo($("#DataId"));u.attr("value","");u.html("");for(var i=0;i<r.length;i++){u=$("<option><\/option>").appendTo($("#DataId"));u.attr("value",r[i].Id);let n=`Data: ${FormataData(r[i].DataHoraInicio)} - Hora Início: ${FormataHora(r[i].DataHoraInicio)} - Hora Fim: ${FormataHora(r[i].DataHoraFim)} - Situação: ${FormatarTipo(r[i].Status)}`;u.html(n)}$("#grdInscricoes").jtable("load",{idPresenca:t,idData:0});$("#divReabrir").hide();$("#divFinalizar").hide()}else $.bsMessageError("Atenção",n.Message)})}function FormataData(n){n=n.split("T");let i=n[0],t=i.split("-");return`${t[2]}/${t[1]}/${t[0]}`}function FormataHora(n){return n=n.split("T"),`${n[1]}`}function FormatarTipo(n){switch(n){case 1:return"Aberto";case 2:return"Andamento";case 3:return"Finalizado";default:return""}}function VerificarCheck(n,t){if(n===!0)$.showYesNoAlert(`Membro confirmou a sua presença através do QrCode.<br />Deseja realmente alterar a sua presença no Curso/Evento?`,"Frequência",()=>{let n={id:$(t).data("inscrid"),idData:$("option:selected",$("#DataId")).val(),situacao:$(t).prop("checked"),justificativa:$(t).data("justificativa")};$.ajaxPost(urlAtualFreqManual,n,function(n){n.status==="OK"?$("#grdInscricoes").jtable("reload"):$.alertError("Frequência",n.Message)})},null,()=>{$("#grdInscricoes").jtable("reload")});else{let n={id:$(t).data("inscrid"),idData:$("option:selected",$("#DataId")).val(),situacao:$(t).prop("checked"),justificativa:$(t).data("justificativa")};$.ajaxPost(urlAtualFreqManual,n,function(n){n.status==="OK"?$("#grdInscricoes").jtable("reload"):$.alertError("Frequência",n.Message)})}}function Botao(n,t,i,r,u){let f="",o=i==="Automática",e=!(u==="Em Aberto"||u==="Andamento");return t===!0?(f=`<input type="checkbox" class="ckbInscr" onchange="VerificarCheck(${o}, this)"
                    data-inscrid="${n}" checked="checked" data-tipo="${i}" id="chb_${n}"
                    ${e?' disabled="disabled" ':""} data-toggle="toggle" data-on="Presente" data-off="Ausente">`,e||(f+=`<center>
                  <a href="#" onclick="Justificativa(${n}, this);return false;" id="lnk_${n}"
                   data-inscrid="${n}" data-tipo="${i}" data-justificativa="${r}">
                    <span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span> Justificar
                  </a>
                  </center>`)):(f=`<input type="checkbox" class="ckbInscr" onchange="VerificarCheck(${o}, this)"
                   data-inscrid="${n}" data-tipo="${i}" id="chb_${n}" data-justificativa="${r}"
                   ${e?' disabled="disabled" ':""} data-toggle="toggle" data-on="Presente" data-off="Ausente">
                  <br />`,r==null||r==""?e||(f+=`<center>
                             <a href="#" onclick="Justificativa(${n}, this);return false;" id="lnk_${n}"
                              data-inscrid="${n}" data-tipo="${i}" data-justificativa="${r}">
                                <span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span> Justificar
                             </a>
                           </center>`):f+=`<center>
                <a href="#" onclick="Justificativa(${n}, this);return false;" id="lnk_${n}"
                 data-inscrid="${n}" data-tipo="${i}" data-justificativa="${r}" data-somenteleitura="${e}">
                    <span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Justificado
                </a>
            </center>`),f}function HabilitarCampos(n){n==="Igreja"?($("#CongregacaoSelecionado").show(),$("#Conteudo").hide(),$("#CpfFiltro").hide()):n==="CPF"?($("#CpfFiltro").show(),$("#CongregacaoSelecionado").hide(),$("#Conteudo").hide()):($("#Conteudo").show(),$("#CongregacaoSelecionado").hide(),$("#CpfFiltro").hide())}function AtualizarSituacaoData(n,t){$.showYesNoAlert(`Deseja ${t?"<b><font color='red'>FINALIZAR<\/font><\/b>":"<b><font color='red'>REABRIR<\/font><\/b>"} a Lista de Presença para ${$("#Descricao").val()}?`,"Frequência",()=>{let i={idData:n,finalizar:t};$.ajaxPost(urlSalvar,i,function(n){n.status==="OK"?document.location.reload(!0):$.alertError("Frequência",n.Message)})})}$(()=>{$("#Status").val()=="Finalizado"?($("#chkDatasFinalizadas").prop("checked",!0),ExibirDatasFinalizadas($("#chkDatasFinalizadas")),$("#divCheck").hide()):ExibirDatasFinalizadas($("#chkDatasFinalizadas"));$("#chkDatasFinalizadas").on("ifChanged",function(n){n.preventDefault;ExibirDatasFinalizadas($("#chkDatasFinalizadas"))});$("#DataId").change(n=>{n.preventDefault;let i=$("#PresencaId").val(),r=$("option:selected",$("#DataId")).val(),t="";$("option:selected",$("#DataId")).text()!=null&&$("option:selected",$("#DataId")).text()!=""&&(t=$("option:selected",$("#DataId")).text().split(" - ")[3].replace("Situação: ",""));t=="Finalizado"?($("#divReabrir").show(),$("#divFinalizar").hide()):t=="Aberto"||t=="Andamento"?($("#divReabrir").hide(),$("#divFinalizar").show()):($("#divReabrir").hide(),$("#divFinalizar").hide());$("#grdInscricoes").jtable("load",{idPresenca:i,idData:r})});HabilitarCampos($("#Filtro").val());$("#Filtro").change(function(n){n.preventDefault();$("#Conteudo").val("");HabilitarCampos($("#Filtro").val())});$("#Conteudo").keypress(function(n){return $("#Filtro").val()==="Id"||$("#Filtro").val()==="MembroId"?(n.keyCode===16&&(isShift=!0),(n.keyCode>=48&&n.keyCode<=57||n.keyCode===8||n.keyCode<=37)&&isShift===!1)?!0:!1:!0});$("#btnPesquisar").click(n=>{n.preventDefault();let i=$("#PresencaId").val(),t=$("option:selected",$("#DataId")).val();if(t!==null&&t!==""){let n=$("#Conteudo").val();$("#Filtro").val()==="Igreja"?n=$("#CongregacaoSelecionado").val():$("#Filtro").val()==="CPF"&&(n=$("#CpfFiltro").val());$("#grdInscricoes").jtable("load",{idPresenca:i,idData:t,filtro:$("#Filtro").val(),conteudo:n})}else $.alertError("Frequência","Favor selecionar uma data para pesquisar na Lista de Presença!")});$("#btnFinalizar").click(n=>{n.preventDefault;let t=$("option:selected",$("#DataId")).val();AtualizarSituacaoData(t,!0)});$("#btnReabrir").click(n=>{n.preventDefault;let t=$("option:selected",$("#DataId")).val();AtualizarSituacaoData(t,!1)});$("#btnImprimir").click(function(n){n.preventDefault();let t=$("option:selected",$("#DataId")).val(),i=$("#PresencaId").val();t!==null&&t!==""?$.showYesNoAlert("Deseja imprimir a Lista de Presença?","Lista de Presença",function(){var n=`${urlImpLista}?idPresenca=${i}&idData=${t}`;$.downloadArquivo(n,$("#btnImprimir"))}):$.alertError("Lista de Presença","Favor selecionar uma data para imprimir a Lista de Presença!")});$("#grdInscricoes").jtable({paging:!0,pageSize:20,sorting:!0,pageSizeChangeArea:!1,defaultSorting:"Nome ASC",actions:{listAction:urlInscricoes},messages:{noDataAvailable:"Não existem Inscrições a serem exibidas!"},fields:{Botoes:{title:"",width:"7%",sorting:!1,display:function(n){return Botao(n.record.Id,n.record.Situacao,n.record.Tipo,n.record.Justificativa,n.record.StatusData)}},Id:{title:"Inscr.Nº",width:"5%",key:!0,columnResizable:!1},MembroId:{title:"RM",width:"5%",key:!0,columnResizable:!1},Nome:{title:"Nome",width:"25%",key:!1,columnResizable:!1},CPF:{title:"CPF",width:"10%",key:!1,columnResizable:!1},Igreja:{title:"Congregação/Igreja",width:"25%",key:!1,columnResizable:!1},Tipo:{title:"Registro",width:"5%",key:!1,columnResizable:!1}},recordsLoaded:function(){$("[data-toggle='toggle']").bootstrapToggle("destroy");$("[data-toggle='toggle']").bootstrapToggle();$("[data-toggle='toggle'] .ckbInscr").each((n,t)=>{let i=`#lnk_${$(t).data("inscrid")}`;$(t).prop("checked")==!0?$(i).hide():$(i).show()})}})});