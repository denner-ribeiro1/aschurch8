function LimparCampos(){$("#MembroId").val("");$("#Cpf").val("");$("#Nome").val("");$("#Congregacao").val("");$("#Cargo").val("");$("#Pago").bootstrapToggle("off");$("#Pago").prop("checked",!1);$("#chkNaoMembro").iCheck("uncheck")}function ExcluirRow(n,t){var i=$(t);let r=`Deseja realmente excluir a inscrição de ${$(i.parents("tr")).find("td:eq(1)").text()} no Curso/Evento?`;$("#PermiteInscricoes").val()==="False"&&(r=`Inscrições já encerradas, após a exclusão não será possivel reinscrever o Membro(a) (${$(i.parents("tr")).find("td:eq(1)").text()}) no Curso/Evento. <br />Deseja realmente excluir o Membro(a)?`);$.showYesNoAlert(r,"Excluir Membro",function(){let t={id:n};$.ajaxPost(urlExcluir,t,function(n){n.status=="OK"?(table.row(i.parents("tr")).remove().draw(),LimparCampos()):$.bsMessageError("Atenção",n.Message)})})}function AtualizarPago(n,t,i){let r={id:n,pago:!t};$.ajaxPost(urlAtualizarPago,r,function(r){r.status=="OK"?(t===!0?($(i).val("Não Pago"),$(i).removeClass("btn-primary"),$(i).addClass("btn-secondary")):($(i).val("Pago"),$(i).removeClass("btn-secondary"),$(i).addClass("btn-primary")),$(i).attr("onclick",`AtualizarPago(${n}, ${!t}, this)`)):$.bsMessageError("Atenção",r.Message)})}function ListarMembros(n,t){let i={idPresenca:n,somenteMembro:t};$.ajaxPost(urlBuscarLista,i,function(n){if(n.status=="OK"){let t=n.data;table!=undefined&&table!=null&&table.destroy();table=$("#grdMembros").DataTable({search:!0,lengthMenu:[[15,25,50,100,-1],[15,25,50,100,"Tudo"],],language:{url:"/lib/plugins/datatables/pt_br.json"},aaData:t,columns:colunas})}else $.bsMessageError("Atenção",n.Message)})}var table,listaMembro=[],files,colunas=[{width:"5%",data:"MembroId",title:"RM",render:n=>n>0?n:"N/M"},{width:"25%",data:"Nome",title:"Nome"},{width:"10%",data:"CPF",title:"CPF"},{width:"27%",data:"Igreja",title:"Congregação/Igreja"},{width:"15%",data:"Cargo",title:"Cargo"},{width:"17%",orderable:!1,searchable:!1,mRender:function(n,t,i){let u=$("#Valor").val(),r="";return u>0&&(r+=`<input type="button" value="${i.Pago?"Pago":"Não Pago"}" class="btn ${i.Pago?"btn-primary":"btn-secondary"} btn-sm" style=";width:80px;" onclick="AtualizarPago(${i.Id}, ${i.Pago}, this);">&nbsp;&nbsp;`),r+`<input type="button" value="Excluir" class="btn btn-danger btn-sm" style="width:80px" onclick="ExcluirRow(${i.Id}, this);">`}},];let isReadOnly=!1;$(()=>{isReadOnly=$("#IsReadOnly").val().toLowerCase()=="true";var n={CongregacaoId:$("#CongregacaoEventoId").val()};$("#lnkMembroId").popUp("Pesquisar Membro","MembroObreiros","MembroId",n);$("#chkNaoMembro").prop("checked",!1);$("#chkNaoMembro").iCheck("uncheck");$("#divManual").show();$("#divArquivo").hide();ListarMembros($("#Presenca").val());$("#Membro").change(function(){$("#Membro").prop("checked")?($("#divMembro").show(),$("#divNaoMembro").hide(),$("#MembroId").removeAttr("readonly"),$("#Cpf").attr("readonly","readonly"),$("#Nome").attr("readonly","readonly"),$("#Congregacao").attr("readonly","readonly"),$("#Cargo").attr("readonly","readonly")):($("#divMembro").hide(),$("#divNaoMembro").show(),$("#Cpf").removeAttr("readonly"),$("#MembroId").removeAttr("readonly"),$("#Nome").removeAttr("readonly"),$("#Congregacao").removeAttr("readonly"),$("#Cargo").removeAttr("readonly"));LimparCampos()});$("#MembroId").change(function(n){var t,i;n.preventDefault;t=$("#MembroId").val();LimparCampos();t>0&&(i={MembroId:t},$.ajaxPost(urlBuscarMembro,i,function(n){if(n.Id==0)$.bsMessageError("Atenção","Membro não cadastrado!");else if(n.Status!=1)$.bsMessageError("Atenção","Membro não Ativo!");else if(n.TipoMembro!=3)$.bsMessageError("Atenção","Membro inválido!");else{if($("#CongregacaoEventoId").val()>0&&$("#CongregacaoEventoId").val()!=n.Congregacao.Id){$.bsMessageError("Atenção",`Evento exclusivo para a Congregação ${$("#CongregacaoEvento").val()}.</br>Membro pertence a Congregação ${n.Congregacao.Nome}!`);return}if($("#MembroId").val(n.Id),$("#Nome").val(n.Nome),$("#Congregacao").val(n.Congregacao.Nome),n.Cargos!=null&&n.Cargos.length>0){var t=n.Cargos.reduce(function(n,t){return n.DataCargo>t.DataCargo?n:t});$("#Cargo").val(t.Descricao)}}}))});$("#Cpf").change(function(n){var t,i;n.preventDefault;t=$("#Cpf").val();LimparCampos();t!=""&&t!=undefined&&t!=null&&(i={cpf:t},$.ajaxPost(BuscarMembroCPF,i,function(n){if(n.msg!=""&&n.msg!=undefined&&n.msg!=null){let i=`${n.msg}<br />Deseja continuar a inscrição sem vincular o membro ao Curso?
                      <br /><br /><font color='red'>Importante: Ao realizar a inscrição como "Não Membro", o sistema não vinculará o membro ao curso, ou seja, não constará no histórico do membro o Curso/Evento.</font>`;$.showYesNoAlert(i,"Inscrição de Não Membro",()=>{$("#Cpf").val(t),$("#Nome").focus()},null,()=>{$("#Membro").prop("checked",!0),$("#Membro").change(),n.id>0&&($("#MembroId").val(n.id),$("#MembroId").change())})}else $("#Cpf").val(t),$("#Nome").focus()}))});$("#btnAddLista").click(n=>{if(n.preventDefault,$("#Membro").prop("checked")){if($("#MembroId").val()==null||$("#MembroId").val()==""){$.bsMessageError("Atenção","Favor selecionar um Membro");$("#MembroId").focus();return}let n={idPresenca:$("#Presenca").val(),idMembro:$("#MembroId").val(),pago:$("#Pago").prop("checked")};$.ajaxPost(urlIncluir,n,function(n){n.status=="OK"?(ListarMembros($("#Presenca").val(),$("#chkNaoMembro").prop("checked")),LimparCampos()):$.bsMessageError("Atenção",n.Message)})}else{let n=$("#frmInscricao");if(n.valid()){let n={idPresenca:$("#Presenca").val(),nome:$("#Nome").val(),cpf:$("#Cpf").val(),igreja:$("#Congregacao").val(),cargo:$("#Cargo").val(),pago:$("#Pago").prop("checked")};$.ajaxPost(urlIncluirNaoMembros,n,function(n){n.status=="OK"?(ListarMembros($("#Presenca").val(),$("#chkNaoMembro").prop("checked")),LimparCampos()):$.bsMessageError("Atenção",n.Message)})}else{var t=ValidarFormulario();t!=null&&t!=undefined&&t!=""&&$.alertError("Inscrições",t)}}});$("#btnCancLista").click(n=>{n.preventDefault(),LimparCampos(),$("#MembroId").focus()});$("input[type=radio][name=optTipo]").change(function(){this.value=="M"?($("#divManual").show(),$("#divArquivo").hide()):this.value=="A"&&($("#divManual").hide(),$("#divArquivo").show());LimparCampos()});$("#chkNaoMembro").on("ifChanged",function(){ListarMembros($("#Presenca").val(),$("#chkNaoMembro").prop("checked"))});$("#Arquivo").change(n=>{n.preventDefault;var t=$("#Arquivo").val().split(".").pop();typeof["xlsx"].find(n=>t.toLowerCase()==n)=="undefined"?($.alertError("Upload de Arquivo","Somente arquivos do Tipo Excel são permitidos para Upload."),$("#Arquivo").val("")):files=n.target.files});$("#btnCapturar").click(()=>{var r,u,t,f,i;let n=$("#Arquivo").val();if(n==null||n==""){$.bsMessageError("Atenção","Favor selecionar o arquivo para Capturar!");$("#Arquivo").focus();return}r=["xlsx"];u=n.split(".").pop();typeof r.find(n=>u.toLowerCase()==n)=="undefined"?($.alertError("Upload de Arquivo","Somente arquivos do Tipo Excel são permitidos para Upload."),$("#Arquivo").val("")):(t=gerarOverlay(),f=gerarLoadingFrame(),t.append(f),$("body").append(t),setTimeout(function(){t.focus()},0),i=new FormData,i.append("files",files[0]),i.append("id",$("#Presenca").val()),$.ajax({type:"POST",url:urlCarregarArquivo,contentType:!1,processData:!1,data:i,success:function(t){if(t.status=="OK"){listaMembro=t.data;let i=`${urlPopUp}?id=${$("#Presenca").val()}&arquivo=${n}`;$.popUpUrl(i,550,800)}else $.alertError("Captura de Arquivo",t.mensagem)},complete:function(){removerOverlay(null)}}))});$("#btnCancelarCapt").click(()=>{$("#Arquivo").val(""),files=null})});