function LimparCampos(n){$("#DataBatismo option").prop("selected",function(){return this.defaultSelected});$("#CongregacaoMembro").selectpicker("val","");$("#CongregacaoMembro").selectpicker("refresh");$("#Cargos").selectpicker("val","");$("#Cargos").selectpicker("refresh");$("#DataBatismo").selectpicker("val","");$("#DataBatismo").selectpicker("refresh");$("#CongregacaoBatismo").selectpicker("val","");$("#CongregacaoBatismo").selectpicker("refresh");$(document).find("[data-valmsg-for='CongregacaoMembro']").html("");$(document).find("[data-valmsg-for='DataBatismo']").html("");table!=null&&table.clear().draw();n?($("#divBatismo").hide(),$("#divMembro").show(),$("#divPesquisar").show()):($("#divBatismo").show(),$("#divMembro").hide(),$("#divPesquisar").show())}function ListarCarteirinhas(n,t,i,r,u){var f={pesqMembro:n,congregacao:t,cargo:i,idBatismo:r,imprimirObrVinc:u};$.ajax({type:"POST",url:urlListarCarteirinhas,data:f,filter:!0,success:function(n){JSON.parse(n).find(n=>n.DataValidadeCarteirinha!=null&&n.DataValidadeCarteirinha!=undefined&&n.DataValidadeCarteirinha!=""&&n.Cargo!=null&&n.Cargo!=undefined&&n.Cargo!="")!=null?$("#divAtualizar").show():$("#divAtualizar").hide();table.destroy();table=$("#grdMembros").DataTable({search:!0,lengthMenu:[[15,25,50,100,-1],[15,25,50,100,"Tudo"],],language:{url:"/lib/plugins/datatables/pt_br.json"},aaData:JSON.parse(n),columns:colunas,select:{style:"multi",info:!1}})}})}function DownloadArquivo(n){var i,u,t,f;$("#btnCarteirinha").prop("disabled",!0);i=gerarOverlay();u=gerarLoadingFrame();i.append(u);$("body").append(i);setTimeout(function(){i.focus()},0);t=new XMLHttpRequest;t.onreadystatechange=function(){var e,i,o,r;if(t.readyState==4){if(t.status==200){var u=t.getResponseHeader("content-disposition").replace(/"/g,""),s=u.substring(u.indexOf("filename=")+9),h=s.split(";"),f=h[0];if(t.response!=null&&navigator.msSaveBlob)return navigator.msSaveBlob(new Blob([t.response],{type:t.response.type}),f);if(e=new Blob([t.response],{type:t.response.type}),i=document.createElement("a"),i.href=window.URL.createObjectURL(e),i.download=f,document.body.appendChild(i),i.click(),document.body.removeChild(i),n){$("#ckAtualizar").iCheck("uncheck");let n=$("option:selected",$("#DataBatismo")).val();ListarCarteirinhas($("#rdoMembro")[0].checked,$("#rdoMembro")[0].checked?$("#CongregacaoMembro").val():$("#CongregacaoBatismo").val(),$("#Cargos").val(),n,$("#chkObrCongr").is(":visible")&&$("#chkObrCongr").prop("checked"))}}else removerOverlay(null),o=new Blob([t.response],{type:t.response.type}),r=new FileReader,r.onload=function(){$.alertError("Download",r.result)},r.readAsText(o);removerOverlay(null);$("#btnCarteirinha").prop("disabled",!1)}};t.open("POST",urlCarteirinhas,!0);t.setRequestHeader("Content-Type","application/json;charset=UTF-8");t.responseType="blob";f=table.rows({selected:!0}).data().toArray();const e=f.reduce((n,t)=>(n.push(t.Id),n),[]);let r={};r.Membros=e;r.AtualizaDtValidade=n;t.send(JSON.stringify(r))}var table,colunas=[{width:"2%",data:null,searchable:!1,render:DataTable.render.select()},{width:"5%",data:"Id",title:"Cód.Membro"},{width:"28%",data:"Nome",title:"Nome"},{width:"10%",data:"Cpf",title:"CPF"},{width:"25%",data:"Congregacao",title:"Congregação"},{width:"20%",data:"Cargo",title:"Cargo"},{width:"10%",data:"DataValidadeCarteirinha",searchable:!1,title:"Data de Validade"},];$(function(){$("#divBatismo").hide();$("#divMembro").show();$("#divPesquisar").show();$("select").selectpicker();table=$("#grdMembros").DataTable({search:!0,language:{url:"/lib/plugins/datatables/pt_br.json"},lengthMenu:[],aaData:[],columns:colunas,select:{info:!1}});$("#rdoMembro").change(function(){LimparCampos(!0)});$("#rdoBatismo").change(function(){LimparCampos(!1)});$("#CongregacaoMembro").change(function(){table.clear().draw()});$("#Cargos").change(function(){table.clear().draw();$("#divObrCongr").show();($("#Cargos").val().length==0||parseInt($("#Cargos").val().find(n=>parseInt(n)==0))==0)&&$("#divObrCongr").hide()});$("#DataBatismo").change(function(){table.clear().draw()});$("#CongregacaoBatismo").change(function(){table.clear().draw()});$("#btnPesquisar").click(function(n){var t,i;if(n.preventDefault(),$("#rdoMembro")[0].checked){t=$(document).find("[data-valmsg-for='CongregacaoMembro']");t.html("");let n=$("#CongregacaoMembro").val();if(n.length==0)return t.html('<span id="CongregacaoMembro-error" class="">Congregação é de preenchimento obrigatório<\/span>'),$.alertError("Carteirinha - Membros","Congregação é de preenchimento obrigatório"),!1;ListarCarteirinhas($("#rdoMembro")[0].checked,$("#CongregacaoMembro").val(),$("#Cargos").val(),0,$("#chkObrCongr").is(":visible")&&$("#chkObrCongr").prop("checked"))}else if($("#rdoBatismo")[0].checked){i=$(document).find("[data-valmsg-for='DataBatismo']");i.html("");let n=$("option:selected",$("#DataBatismo")).val();if(n==undefined||n=="")return i.html('<span id="DataBatismo-error" class="">Data de Batismo é de preenchimento obrigatório<\/span>'),$.alertError("Carteirinha - Membros","Data de Batismo é de preenchimento obrigatório"),!1;ListarCarteirinhas($("#rdoMembro")[0].checked,$("#CongregacaoBatismo").val(),null,n,$("#chkObrCongr").is(":visible")&&$("#chkObrCongr").prop("checked"))}else return $.alertError("Carteirinha - Membros","Selecione um filtro válido"),!1});$("#btnCarteirinha").click(function(n){n.preventDefault();let t=table.rows({selected:!0}).data().toArray().length;t<501?t>0?$("#ckAtualizar")[0].checked?Swal.fire({title:"<strong>Membro<\/strong>",html:`Imprimir a${t>1?"s":""} carteirinha${t>1?"s":""} selecionada${t>1?"s":""} (${t})?`,icon:"question",input:"checkbox",inputValue:1,inputPlaceholder:"&nbsp;&nbsp;Atualizar a Data de Validade das Carteirinhas dos membros.",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:'<i class="fa fa-check-circle"><\/i> Sim',cancelButtonText:'<i class="fa fa-ban"><\/i> Não',width:500,allowOutsideClick:!1}).then(n=>{(n.value||n.value===0||n.value===1)&&DownloadArquivo(n.value===1)}):$.showYesNoAlert(`Imprimir a${t>1?"s":""} carteirinha${t>1?"s":""} selecionada${t>1?"s":""} (${t})?`,"Membro",function(){DownloadArquivo(!1)}):$.alertError("Carteirinhas","Não há membros selecionados para a geração das Carteirinhas!"):$.alertError("Carteirinhas",`Quantidade de carteirinhas (${t}) selecionadas maior que a quantidade máxima (500 membros) permitida.`)})});