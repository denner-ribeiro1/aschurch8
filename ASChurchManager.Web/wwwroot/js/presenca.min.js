function SalvarAtualizar(){if(ValidarHoras()){if(indexData>-1){let n=datas[indexData].Id;editedData={Acao:n>0?2:0,Id:n,Data:$("#Data").val(),HoraInicio:$("#HoraInicio").val(),HoraFinal:$("#HoraFinal").val()};datas=datas.map(t=>t.Id!==n?t:editedData)}else datas.push({Acao:0,Id:0,Data:$("#Data").val(),HoraInicio:$("#HoraInicio").val(),HoraFinal:$("#HoraFinal").val()});datas.sort(function(n,t){let i=n.Data.split("/"),r=t.Data.split("/"),u=i[1]+"/"+i[0]+"/"+i[2],f=r[1]+"/"+r[0]+"/"+r[2];return new Date(u+" "+n.HoraInicio)-new Date(f+" "+t.HoraInicio)});MontarGridDatas();indexData=-1;HabilitaBotoesAtualAdic(!1);$("#Data").val(RetornaDataAtual());$("#HoraInicio").val("");$("#HoraFinal").val("")}}function ExcluirRowData(n){let t=n,i={idData:datas[t].Id};$.ajaxPost(urlExisteInscricaoData,i,function(n){if(n.status=="OK"){let i="Deseja excluir a Data?";n.data===!0&&(i=`<h3 style="color: red">Existem registros de Presença para a data (${datas[t].Data}). Você tem certeza que deseja excluir este data?<br/ ><br />Após a confirmação NÃO será possível recuperar os registros de Presença para a data.</h3>`);$.showYesNoAlert(i,"Excluir Data",function(){datas[t].Acao=3;MontarGridDatas()})}else $.bsMessageError("Atenção",n.Message)})}function AtualizarRowData(n){indexData=n;$("#Data").val(datas[indexData].Data);$("#HoraInicio").val(datas[indexData].HoraInicio);$("#HoraFinal").val(datas[indexData].HoraFinal);HabilitaBotoesAtualAdic(!0);HabilitarBotoesTabela($(document.getElementById("tbDatas").getElementsByTagName("tbody")),!0)}function HabilitaInscricaoAutom(n){n?$("#divInscAutom").show():$("#divInscAutom").hide()}function HabilitaBotoesAtualAdic(n){n?($("#btnAddData").hide(),$("#btnUpdData").show()):($("#btnAddData").show(),$("#btnUpdData").hide())}function HabilitarBotoesTabela(n,t){$(n).find("tr").each(function(n,i){var r=$(i);$(r).find(".btn").each(function(n,i){$(i).prop("disabled",t)})})}function MontarGridDatas(){var n,r;let t=document.getElementById("tbDatas").getElementsByTagName("tbody")[0];$(t).empty();let i=0;if(datas!=null&&datas.length>0){for(n=0;n<datas.length;n++)if(datas[n].Acao!==3){let u=t.insertRow(i);u.className="jtable-data-row"+(n%2==0?" jtable-row-even":"");$.incluirCelulasTabela(u,0,null,datas[n].Data);$.incluirCelulasTabela(u,1,null,datas[n].HoraInicio);$.incluirCelulasTabela(u,2,null,datas[n].HoraFinal);isreadonly||(r=` <button type="button" class="btn btn-info btn-sm" onclick="AtualizarRowData(${n});"><span class="glyphicon glyphicon-refresh"></span> Atualizar</button>
                         <button type="button" class="btn btn-danger btn-sm" onclick="ExcluirRowData(${n});"><span class="glyphicon glyphicon-trash"></span> Excluir</button>`,$.incluirCelulasTabela(u,3,null,r));i++}}else{let i=t.insertRow(n);i.className="jtable-data-row";$.incluirCelulasTabela(i,0,"100%","Não existem Datas cadastradas para o Curso/Evento.",4)}}function ValidarHoras(){var t=$("#Data").val(),i=$("#HoraInicio").val(),r=$("#HoraFinal").val(),n;if(t===undefined||t==="")return $.bsMessageError("Atenção","Data do Curso/Evento é de preenchimento obrigatório."),!1;if(i===undefined||i==="")return $.bsMessageError("Atenção","Hora do Início do Curso/Evento é de preenchimento obrigatório."),!1;if(r===undefined||r==="")return $.bsMessageError("Atenção","Hora do Término do Curso/Evento é de preenchimento obrigatório."),!1;var u=t.split("/"),e=u[1]+"/"+u[0]+"/"+u[2],f=new Date(e+" "+i);return(f=f.getTime(),n=new Date(e+" "+r),n=n.getTime(),f>n)?($.bsMessageError("Atenção","Hora do Início é maior que a Hora Final do Curso/Evento."),$("#HoraInicio").val(""),$("#HoraFinal").val(""),!1):!0}function RetornaDataAtual(){let n=new Date,t=padLeft(n.getDate(),"0",2),i=padLeft(n.getMonth()+1,"0",2),r=n.getFullYear();return`${t}/${i}/${r}`}function ValidarFormulario(){var n="";return $("span[id*=-error]").each(function(t,i){n+=$(i).text()+"<br>"}),n}function CarregarArquivos(n,t){if(n!=null&&n.length>0){let r="";$("#divCard").html("");let u=1;for(var i=0;i<n.length;i++)r+=Arquivo(n[i].Nome,n[i].Tamanho,n[i].Tipo.toLowerCase(),$("#Id").val(),t),u%6==0&&($("#divCard").append(`<div class="row" id="div${i}">`),$(`#div${i}`).append(r),r=""),u++;r!=""&&($("#divCard").append(`<div class="row" id="div${n.length}">`),$(`#div${n.length}`).append(r))}else $("#divCard").html("<label>Não há arquivos armazenados para o Curso/Evento.<\/label>")}function Arquivo(n,t,i,r,u){return`<div class="col-sm-5 col-lg-2 col-xl-1">
            <div class="file-man-box">
                ${u==!0?`<a href="javascript:void(0)" onclick="DeleteArquivo('${n}', ${r});return false;" class="file-close" title="Excluir Arquivo"><i class="glyphicon glyphicon-floppy-remove"></i></a>`:""}
                <div class="file-img-box"><img src="/images/${i}.svg" alt="${n}" title="${n}"></div>
                    <div class="file-man-title">
                        <h5 class="mb-0 text-overflow">${n}</h5>
                        <p class="mb-0"><small>${bytesToSize(t)}</small></p>
                    </div>
                    <a href="javascript:void(0)" onclick="DownloadArquivo('${n}', ${r});return false;" class="file-download" title="Baixar Arquivo"><i class="glyphicon glyphicon-download  file-img-dowload" style="margin: 10px"></i></a>
                </div>
            </div>`}function DownloadArquivo(n,t){let i=`${urlDownload}?idPresenca=${t}&nomeArquivo=${n}`;$.downloadArquivo(i,null)}function DeleteArquivo(n,t){$.showYesNoAlert(`Deseja excluir o arquivo ${n}?`,"Excluir Arquivo",function(){let i={idPresenca:t,nomeArquivo:n};$.ajaxPost(urlExcArq,i,function(n){n.status=="OK"?(arquivos=n.data,CarregarArquivos(arquivos,$("#Acao").val()=="Update")):$.bsMessageError("Atenção",n.Message)})})}function bytesToSize(n){var t;return n==0?"0 Byte":(t=parseInt(Math.floor(Math.log(n)/Math.log(1024))),Math.round(n/Math.pow(1024,t),2)+" "+["Bytes","KB","MB","GB","TB"][t])}let indexData=-1,isreadonly=!1;var files;$(()=>{$("#Valor").maskMoney({prefix:"",allowNegative:!1,thousands:".",decimal:",",affixesStay:!1});isreadonly=$("#IsReadOnly").val().toLowerCase()=="true";datas==null&&(datas=[]);isreadonly?($("#divDatas").hide(),$("#divDatas").attr("disabled","disabled")):($("#divDatas").show(),$("#divDatas").removeAttr("disabled"));CarregarArquivos(arquivos,$("#Acao").val()=="Update");var n=$("#hdnUsuarioSede").val().toLowerCase()==="true";$("#lnkBuscarCongregacao").removeAttr("class");n===!1?($("#CongregacaoId").attr("readonly","readonly"),$("#lnkBuscarCongregacao").attr("class","readonly")):$("#lnkBuscarCongregacao").popUp("","Congregacao","CongregacaoId");HabilitaInscricaoAutom($("#CongregacaoId").val()=="1");MontarGridDatas(datas);HabilitaBotoesAtualAdic(!1);$("#CongregacaoId").change(n=>{var t,i;n.preventDefault;t=$("#CongregacaoId").val();t>0&&(i={CongregacaoId:t},$.ajaxPost(urlBuscarCongregacao,i,function(n){$("#CongregacaoNome").val("");n.Id==0?($.bsMessageError("Atenção","Código inválido!"),$(this).val("")):n.Id>0&&($("#CongregacaoNome").val(n.Nome),HabilitaInscricaoAutom($("#CongregacaoId").val()=="1"))}))});$("#HoraFinal").blur(n=>{n.preventDefault,ValidarHoras()});$("#btnAddData").click(n=>{n.preventDefault,SalvarAtualizar()});$("#btnUpdData").click(n=>{n.preventDefault,SalvarAtualizar()});$("#btnCancData").click(n=>{n.preventDefault(),$("#Data").val(RetornaDataAtual()),$("#HoraInicio").val(""),$("#HoraFinal").val(""),indexData=-1,HabilitaBotoesAtualAdic(!1),isreadonly||HabilitarBotoesTabela($(document.getElementById("tbDatas").getElementsByTagName("tbody")),!1)});$("#btnSalvar").click(n=>{n.preventDefault(),$.showYesNoAlert("Deseja realmente salvar um Evento/Curso?","Controle de Presença em Eventos/Cursos",function(){let t=$("#frmPresenca"),i=t.attr("action");if(t.validate(),t.valid())$("#DatasJSON").val(JSON.stringify(datas)),$.ajaxPostForm(i,$("#frmPresenca"),function(n){n.status==="OK"?window.location=n.url:$.alertError("Controle de Presença em Eventos/Cursos",n.msg)});else{var n=ValidarFormulario();n!=null&&n!=undefined&&n!=""&&$.alertError("Controle de Presença em Eventos/Cursos",n)}})});$("#lnkExcluir").click(n=>{n.preventDefault();var t={id:$("#Id").val()};$.showYesNoAlert('<h3 style="color:red">Você tem certeza que deseja excluir este Evento/Curso?<\/br>Após a confirmação todos os dados referentes ao Evento/Cursos serão perdidos.<\/h3>',"Controle de Presença em Eventos/Cursos",function(){$.ajaxPost(urlExcluir,t,function(n){n.status=="OK"?window.location=n.url:$.alertError("Controle de Presença em Eventos/Cursos",n.mensagem)})})});$("#Arquivo").change(n=>{if($("#Arquivo").val()!=""){n.preventDefault;var t=$("#Arquivo").val().split(".").pop();typeof["xls","xlsx","doc","docx","pdf","zip"].find(n=>t.toLowerCase()==n)=="undefined"?($.alertError("Upload de Arquivo","Somente arquivos dos Tipos Excel, Word, PDF e ZIP são permitidos para Upload."),$("#Arquivo").val("")):files=n.target.files}});$("#btnIncluir").click(()=>{var i,r,n,u;let t=$("#Arquivo").val();if(t==null||t==""){$.bsMessageError("Atenção","Favor selecionar o arquivo para Capturar!");$("#Arquivo").focus();return}if(files!=null&&files!=undefined&&files.length>0&&files[0].size>7340032){$.bsMessageError("Atenção",`Arquivo maior que 7 MB. Tamanho do arquivo selecionado: ${bytesToSize(files[0].size)}`);$("#Arquivo").focus();return}if(i=["xls","xlsx","doc","docx","pdf","zip"],r=t.split(".").pop(),typeof i.find(n=>r.toLowerCase()==n)=="undefined")$.alertError("Upload de Arquivo","Somente arquivos dos Tipos Excel, Word, PDF e ZIP são permitidos para Upload."),$("#Arquivo").val("");else{let t={idPresenca:$("#Id").val(),nomeArquivo:files[0].name};n=gerarOverlay();u=gerarLoadingFrame();n.append(u);$("body").append(n);setTimeout(function(){n.focus()},0);$.ajax({cache:!1,type:"POST",url:urlArqJaExiste,contentType:"application/x-www-form-urlencoded",dataType:"json",data:t,error:function(n,t,i){console.log(i);console.log(n.responseText)},success:function(n){var i,r,u;if(n.status=="OK"){let f=n.data;f==!0?(removerOverlay(null),$.showYesNoAlert(`O Arquivo ${t.nomeArquivo} já existe. Deseja sobrepor o arquivo?`,"Arquivo já existe",function(){var t=new FormData,n,i;t.append("files",files[0]);t.append("idPresenca",$("#Id").val());n=gerarOverlay();i=gerarLoadingFrame();n.append(i);$("body").append(n);setTimeout(function(){n.focus()},0);$.ajax({type:"POST",url:urlUplArq,contentType:!1,processData:!1,data:t,error:function(n,t,i){console.log(i);console.log(n.responseText)},success:function(n){n.status=="OK"?(arquivos=n.data,CarregarArquivos(arquivos,$("#Acao").val()=="Update"),$("#Arquivo").val("")):$.alertError("Upload de Arquivo",n.mensagem)},complete:function(){removerOverlay(null)}})})):(removerOverlay(null),i=new FormData,i.append("files",files[0]),i.append("idPresenca",$("#Id").val()),r=gerarOverlay(),u=gerarLoadingFrame(),r.append(u),$("body").append(r),setTimeout(function(){r.focus()},0),$.ajax({type:"POST",url:urlUplArq,contentType:!1,processData:!1,data:i,error:function(n,t,i){console.log(i);console.log(n.responseText)},success:function(n){n.status=="OK"?(arquivos=n.data,CarregarArquivos(arquivos,$("#Acao").val()=="Update"),$("#Arquivo").val("")):$.alertError("Upload de Arquivo",n.mensagem)},complete:function(){removerOverlay(null)}}))}else removerOverlay(null),$.bsMessageError("Atenção",n.Message)}})}});$("#btnCancelar").click(()=>{$("#Arquivo").val(""),files=null})});