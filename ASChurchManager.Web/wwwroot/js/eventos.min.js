function SalvarEvento(n){$.showYesNoAlert(n,"Eventos",function(){var n=$("#frmEventos");n.valid()&&($('<div id="div-loading"><div><\/div><\/div>').appendTo("body"),$.ajax({type:"POST",url:n.attr("action"),data:n.serialize(),success:function(n){n.status=="OK"?parent.$.fancybox.close():$.alertError("Membro",n.msg)},complete:function(){$("#div-loading").remove()}}))})}function PesquisarCongregacao(n,t){if(n>0){var i={CongregacaoId:n};t="#"+t;$.ajaxPost("/Secretaria/Congregacao/BuscarCongregacao",i,function(n){$(t).val("");n.Id==0?($.bsMessageError("Atenção","Código inválido!"),$(this).val("")):$(t).val(n.Nome)})}}function ExcluirEvento(n,t){request={id:n,excluirVinc:t};$.showYesNoAlert('<h3 style="color:red">Você tem certeza que deseja excluir este Evento?<br><\/br>Após a confirmação NÃO será mais possível recuperar o Evento.<\/h3>',"Eventos",function(){$.ajaxPost(urlExcluir,request,function(n){n.status=="OK"?parent.$.fancybox.close():$.alertError("Erro",n.msg)})})}$(function(){var n,u,f;if($("#Tipo").val()==="Evento"&&(n=$("#DataInicio").val(),n===null||n===undefined||n==="")){var r=new Date,t=r.getDate(),i=r.getMonth()+1,e=r.getFullYear();t<10&&(t="0"+t);i<10&&(i="0"+i);u=t+"/"+i+"/"+e;$("#DataInicio").val(u);$("#DataInicio").removeAttr("readonly")}$("#TipoFrequenciaSelecionado").val()!=="1"?$("#quantidade").show():$("#quantidade").hide();$("#TipoFrequenciaSelecionado").change(function(){if($(this).val()!=="1"){if($(this).val()==="4"){var t=$("#DataInicio").val(),n=t.split("/")[0];n>28&&$.alert("Aviso","Para os meses que não possuem o dia escolhido("+n+"), o Evento será agendado sempre no último dia de cada mês!")}$("#quantidade").show()}else $("#quantidade").hide()});$("#lnkBuscarCongregacao").removeAttr("class");f=$("#hdnUsuarioSede").val().toLowerCase()==="true";f===!1?($("#CongregacaoId").attr("readonly","readonly"),$("#lnkBuscarCongregacao").attr("class","readonly")):$("#lnkBuscarCongregacao").popUp("","Congregacao","CongregacaoId");$("#CongregacaoId").blur(function(){PesquisarCongregacao($("#CongregacaoId").val(),"CongregacaoNome");$("#CodigoCongregacaoSede").val()!==$("#CongregacaoId").val()?$("#divCheck").hide():$("#divCheck").show()});$("#HoraFinal").blur(function(){var e=$("#CongregacaoId").val(),o=$("#DataInicio").val(),s=$("#DataInicio").val(),t=$("#HoraInicio").val(),i=$(this).val(),n;if(e===undefined||e===0){$.bsMessageError("Atenção","Congregação é de preenchimento obrigatório.");return}if(t===undefined||t===""){$.bsMessageError("Atenção","Hora do Início do Evento é de preenchimento obrigatório.");return}if(i===undefined||i===""){$.bsMessageError("Atenção","Hora do Término do Evento é de preenchimento obrigatório.");return}var r=o.split("/"),h=r[1]+"/"+r[0]+"/"+r[2],u=s.split("/"),c=u[1]+"/"+u[0]+"/"+u[2],f=new Date(h+" "+t);f=f.getTime();n=new Date(c+" "+i);n=n.getTime();f>n&&($.bsMessageError("Atenção","Hora do Início é maior que a Hora Final do Evento."),$("#HoraInicio").val(""),$("#HoraFinal").val(""))});$("#lnkFechar").click(function(){parent.$.fancybox.close()});$("#lnkSalvar").click(function(n){var t="Deseja realmente criar um novo Evento?",i;$("#Acao").val()==="Update"&&(t="Deseja realmente atualizar o Evento?");i={dataInicial:$("#DataInicio").val()+" "+$("#HoraInicio").val(),dataFinal:$("#DataInicio").val()+" "+$("#HoraFinal").val(),congregacao:$("#CongregacaoId").val(),frequencia:$("#TipoFrequenciaSelecionado").val(),quantidade:$("#Quantidade").val()};$.ajaxPost(urlValDatas,i,function(i){n.preventDefault;i.status==="OK"?i.msg!==""&&i.msg!==undefined?$.showYesNoAlert(i.msg,"Eventos",function(){SalvarEvento(t)},null,function(){$("#HoraInicio").val("");$("#HoraFinal").val("")}):SalvarEvento(t):$.bsMessageError("Atenção",i.msg)})});$("#lnkExcluir").click(function(n){n.preventDefault;var r=parseInt($("#TipoFrequenciaSelecionado").val()),i=parseInt($("#Quantidade").val()),t=parseInt($("#Id").val());r>1&&i>0?$.showYesNoAlert('<h4 style="color:red">Existe(m) '+i+" evento(s) vinculado(s) ao Evento a ser excluído.<br><\/br>Deseja remover todos os Eventos vinculados?<\/h4>","Eventos",function(){ExcluirEvento(t,!0)},null,function(){ExcluirEvento(t,!1)}):ExcluirEvento(t,!1)})});