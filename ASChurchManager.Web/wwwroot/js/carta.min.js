function textCounter(){var n=1e3,t=$("textarea[id$='Observacao']").val().length;t>n?$("#Observacao").val(field.substring(0,n)):$("#qtdCarac").val(n-t)}function FiltrarGrid(n,t){var i={TipoCarta:n,Status:t};$.ajaxPost("/Secretaria/Carta/GridCarta",i,function(n){$("#divGridCarta").html(n)},"html")}$(function(){"use strict";var n,r,t,i,u;Date.prototype.addDias=function(n){this.setDate(this.getDate()+n)};n=$("#acao").val();(n=="Update"||n=="Read"||n=="Delete")&&(r=document.getElementById("divCongregacaoDest"),t=$("option:selected",$("#TipoCarta")).text(),r.style.display="block",i=document.getElementById("divCodCongrDest"),t=="Transferência"?i.style.display="block":(t=="Mudança"||t=="Recomendação")&&(i.style.display="none"));u={TipoMembro:3,Status:1};$("#linkIdMembro").popUp("","Membro","MembroId",u);$("#MembroId").blur(function(){var n=parseInt($("#MembroId").val()),t;n>0&&(t={MembroId:n},$.ajaxPost(urlBuscarMembro,t,function(n){n.status==="ERRO"?($.bsMessageError("Atenção",n.msg),$("#MembroId").val(""),$("#Nome").val(""),$("#CongregacaoOrigemId").val(""),$("#CongregacaoOrigem").val("")):($("#Nome").val(n.membro.Nome),$("#CongregacaoOrigemId").val(n.membro.Congregacao.Id),$("#CongregacaoOrigem").val(n.membro.Congregacao.Nome))}))});$("#DataValidade").change(function(){var n=$(this).val(),i=$(document).find("[data-valmsg-for='DataValidade']"),t;return i.html(""),n!=null&&n!=undefined&&n!=""&&(t=new Date,t.setYear(n.split("/")[2]),t.setMonth(n.split("/")[1]-1),t.setDate(n.split("/")[0]),t.getTime()<(new Date).getTime())?(i.html('<span id="DataValidade-error" class="">A Data de Validade da Carta deve ser maior que a Data Atual<\/span>'),!1):void 0});$("#TipoCarta").change(function(){var t=$("option:selected",$(this)).text(),n=new Date,r,i;n.addDias(t==="Recomendação"?30:60);r=(n.getDate()<9?"0":"")+n.getDate()+"/"+(n.getMonth()+1<9?"0":"")+(n.getMonth()+1)+"/"+n.getFullYear();$("#DataValidade").val(r);document.getElementById("divCongregacaoDest").style.display="block";i=document.getElementById("divCodCongrDest");t==="Transferência"?(i.style.display="block",$("#CongregacaoDestId").val(""),$("#CongregacaoDestId").focus(),$("#CongregacaoDest").val(""),$("#CongregacaoDest").attr("readonly","readonly"),$("#CongregacaoDest").val("")):(t==="Mudança"||t==="Recomendação")&&(i.style.display="none",$("#CongregacaoDest").removeAttr("readonly"),$("#CongregacaoDest").val(""),$("#CongregacaoDest").focus())});$("#lnkBuscarCongregacao").popUp("","Congregacao","CongregacaoDestId");$("#CongregacaoDestId").change(function(){var t=$(document).find("[data-valmsg-for='CongregacaoDestId']"),n,i,r;if(t.html(""),n=$(this).val(),i=$("#CongregacaoOrigemId").val(),n==i)return t.html('<span id="CongregacaoDestId-error" class="">Congregação Destino deve ser diferente da Congregação Origem<\/span>'),!1;n>0&&(r={CongregacaoId:n},$.ajaxPost("/Secretaria/Congregacao/BuscarCongregacaoSemFiltroUsuario",r,function(n){$("#CongregacaoDest").val("");n.Id==0?($.bsMessageError("Atenção","Código de Congregação inválido!"),$(this).val("")):n.Id>0&&$("#CongregacaoDest").val(n.Nome)}))});$("#Observacao").keydown(function(){textCounter()});$("#Observacao").keyup(function(){textCounter()});$("#TipoCartaSelecionado").change(function(){FiltrarGrid($("option:selected",$(this)).text(),$("option:selected",$("#StatusCartaSelecionado")).text())});$("#StatusCartaSelecionado").change(function(){FiltrarGrid($("option:selected",$("#TipoCartaSelecionado")).text(),$("option:selected",$(this)).text())});$("#CodigoEmissao").change(function(){var n,t;$("#CodigoEmissao").val()!==null&&$("#CodigoEmissao").val()!==""&&(n=$(document).find("[data-valmsg-for='CodigoEmissao']"),n.html(""),t={id:$("#Id").val(),codigoEmissao:$("#CodigoEmissao").val()},$.ajaxPost("/Carta/ValidarCodigoRecebCarta",t,function(t){t.Erro!==null&&t.Erro!==undefined&&t.Erro!==""&&(n.html('<span id="CodigoEmissao-error" class="">'+t.Erro+"<\/span>"),$.bsMessageError("Atenção",t.Erro),$(this).val(""))}))});$(document).on("click","#lnkExcluir",{},function(n){n.preventDefault();var t={id:$(this).data("cartaid")};$.showYesNoAlert('<h3 style="color:red">Você tem certeza que deseja Cancelar esta Carta?<\/br>Após a confirmação NÃO será mais possível reverter o Cancelamento.<\/h3>',"Carta de Transferência",function(){$.ajaxPost(urlExcluir,t,function(n){n.status=="OK"?window.location=n.url:$.alertError("Carta de Transferência",n.mensagem)})})});$(document).on("click","#lnkPrint",{},function(n){n.preventDefault();var t=$(this).data("templateid"),i=$(this).data("targetmodel"),r=$(this).data("id");$.showYesNoAlert("Deseja imprimir esta Carta ?","Imprimir Carta",function(){var n=urlPrint+"?templateId="+t+"&targetModel="+i+"&modelId="+r;$.downloadArquivo(n,null)})});$("#btnAprovar").click(function(n){n.preventDefault;$.showYesNoAlert("Após a Aprovação não será possível atualizar o Conteúdo da Carta. Deseja realmente APROVAR a Carta?","Carta de Transferência",function(){var n={id:$("#Id").val(),codigoRecebimento:$("#CodigoEmissao").val()};$.ajaxPost(urlAprovar,n,function(n){n.status==="OK"?window.location=n.url:$.alertError("Carta de Transferência",n.mensagem)})})});$("#btnSalvar").click(function(n){if(n.preventDefault,isNaN(parseInt($("#MembroId").val()))||parseInt($("#MembroId").val())==0)$.alertError("Carta de Transferência","Registro do Membro deve ser maior que zero"),$("#MembroId").focus();else if($("#Nome").val()==""||$("#Nome").val()==null||$("#Nome").val()==undefined)$.alertError("Carta de Transferência","Nome do Membro é de preenchimento obrigatório"),$("#Nome").focus();else if($("option:selected",$("#TipoCarta")).text()=="")$.alertError("Carta de Transferência","Tipo de Carta é de preenchimento obrigatório"),$("#TipoCarta").focus();else if($("option:selected",$("#TipoCarta")).text()=="Transferência"&&$("#CongregacaoDest").val()==""||$("#CongregacaoDest").val()==null||$("#CongregacaoDest").val()==undefined)$.alertError("Carta de Transferência","Congregação de Destino é de preenchimento obrigatório"),$("#CongregacaoDest").focus();else if($("option:selected",$("#TemplateCartaSelecionado")).text()=="")$.alertError("Carta de Transferência","Template de Carta é obrigatório"),$("#TemplateCartaSelecionado").focus();else if(!isNaN(parseFloat($("#CongregacaoDestId").val()))&&parseFloat($("#CongregacaoDestId").val())>0&&$("#CongregacaoDestId").val()==$("#CongregacaoOrigemId").val())$.alertError("Carta de Transferência","Congregação Destino deve ser diferente da Congregação Origem"),$("#CongregacaoDestId").focus();else{var t="Deseja realmente criar uma nova Carta de Transferência?";$("#acao").val()=="Update"&&(t="Deseja realmente atualizar a Carta de Transferência?");$.showYesNoAlert(t,"Carta de Transferência",function(){$.ajaxPostForm(urlSalvar,$("#frmCarta"),function(n){if(n.status=="OK"){var t=n.url,i=n.id,r=n.templateid;$.showYesNoAlert(n.mensagem,"Carta de Transferência",function(){var n=urlPrint+"?templateId="+r+"&targetModel=Carta&modelId="+i;$.downloadArquivo(n,null,t)},null,function(){window.location=t},null)}else $.alertError("Carta de Transferência",n.mensagem)})})}})});